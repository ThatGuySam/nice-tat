---
/**
 * Home page with automatic article listing.
 * Articles are MDX files using BlogLayout.
 */
import Layout from '../layouts/Layout.astro'

/**
 * Article frontmatter shape for MDX pages.
 */
interface ArticleFrontmatter {
  title?: string;
  description?: string;
  publishDate?: string;
  layout?: string;
}

interface ArticleModule {
  frontmatter: ArticleFrontmatter;
  url?: string;
}

// Use import.meta.glob (modern replacement for Astro.glob)
const mdxModules = import.meta.glob<ArticleModule>(
  './*.mdx',
  { eager: true }
)

// Filter to only pages using BlogLayout
const articles = Object.entries(mdxModules)
  .filter(([_, module]) => {
    const layout = module.frontmatter?.layout
    return layout?.includes('BlogLayout')
  })
  .map(([filepath, module]) => {
    // Convert filepath to URL: ./example-article.mdx -> /example-article
    const url = filepath
      .replace('./', '/')
      .replace('.mdx', '')
    return {
      title: module.frontmatter?.title,
      description: module.frontmatter?.description,
      publishDate: module.frontmatter?.publishDate,
      url,
    }
  })
  // Sort by date, newest first
  .sort((a, b) => {
    const dateA = new Date(a.publishDate || 0)
    const dateB = new Date(b.publishDate || 0)
    return dateB.getTime() - dateA.getTime()
  })
---

<Layout frontmatter={{ title: 'Nice Tat Astro Template' }}>
  <!-- Markdown Preview - https://dillinger.io/ -->

  <h1>Nice Tat Astro Template</h1>

  <p><a href="/how-to-use">using this template</a></p>
  <p><a href="https://www.youtube.com/watch?v=sEyHnHjhlr4">youtube</a></p>
  <p><a href="https://github.com/ThatGuySam/nice-tat">github</a></p>
  <p><a href="https://www.instagram.com/caseyneistat/">instagram</a></p>
  <p><a href="/onlyfans">onlyfans</a></p>
  <p><a href="https://twitter.com/Casey">twitter</a></p>
  <p><a href="/contact">contact</a></p>

  {/* Article listing */}
  {articles.length > 0 && (
    <section class="my-8 pt-6">
      <h2 class="tracking-wide mb-4">
        Articles
      </h2>
      <ul class="space-y-3">
        {articles.map((article) => (
          <li>
            <a href={article.url} class="block group">
              <span class="group-hover:underline">
                {article.title}
              </span>
              {article.publishDate && (
                <span class="
                  text-gray-500 text-sm ml-2
                ">
                  {new Date(article.publishDate)
                    .toLocaleDateString('en-US', {
                      month: 'short',
                      day: 'numeric',
                      year: 'numeric',
                    })}
                </span>
              )}
            </a>
          </li>
        ))}
      </ul>
    </section>
  )}
</Layout>
